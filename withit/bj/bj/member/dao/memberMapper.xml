<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="memberSQL">
	<insert id="join1" parameterType="java.util.Map">
		insert into users(username, password) values(#{username}, #{password});
		insert into authorities values(#{username}, #{auth});
	</insert>
	
	<!-- 로그인  -->
	<select id="getNickname" parameterType="String" resultType="String">
		select nickname from db.membertable where username=#{username}
	</select>
	
	<!-- 비밀번호 찾기에서 비밀번호 변경 -->
	<update id="newPwd" parameterType="java.util.Map">
		update membertable set password=#{password} where username=#{username}
	</update>
	
	<!-- 회원가입 -->
	
	<insert id="join" parameterType="java.util.Map">
		insert into db.membertable(username, nickname, password) values(#{username}, #{nickname}, #{password})
	</insert>
	
	<insert id="addInfo" parameterType="member">
		insert into db.membertable(username, nickname, password) values(#{username}, #{nickname},#{password})
	</insert>
	
	<select id="checkMember" parameterType="String" resultType="member">
		select * from db.membertable where username=#{username}
	</select>
	
	<!-- 관리자 페이지 회원정보 불러오기 -->
	
	<select id="getMember" resultType="member">
		select * from db.membertable
	</select>
  	
  	<!-- ============================ 채         팅 ============================ -->
  	
  	<!-- 채팅 저장 -->
  	
  	<insert id="sendMessage" parameterType="chatting">
  		insert into ${chattingRoom}(username, nickname, chat, chat_date) values(#{username}, #{nickname}, #{chat}, #{chat_date})
  	</insert>
  	
  	<!-- 채팅 가져오기 -->
  	
  	<select id="getChatting" resultType="chatting">
  		select * from ${chattingRoom}
  	</select>
  	
  	<!-- 채팅방 프리뷰 가져오기 -->
  	
  	<select id="getLastChatting" parameterType="String" resultType="chatting">
  		select * from ${chattingRoom} order by chat_date desc limit 1
  	</select>
  	
  	<!-- 전체 채팅방 프리뷰 가져오기 -->
  	
  	<select id="getAllChatting" resultType="chattingRoom">
  		select * from db.chattingRoom order by chat_date desc limit 1
  	</select>
  	
  	<!-- 채팅방 생성 -->
  	
  	<select id="createChat" parameterType="java.util.Map">
  		${create_table}
  	</select>
  	
	<!-- 채팅방 생성시 같은 이름이 있는지 확인 -->
	
	<select id="checkRoomName" parameterType="String" resultType="String">
		select db.chattingRoom from chattingRoomList where chattingRoom=#{chattingRoomName}
	</select>

  	<!-- 채팅방 리스트 뽑아오기 -->
  	
  	<select id="getChattingRoom" parameterType="String" resultType="chattingRoom">
  		select * from db.chattingRoomList where members like concat('%',#{username},'%')
  	</select>
  	
  	<!-- 채팅방에 들어가기 -->
  	
	<insert id="joinChattingRoom" parameterType="java.util.Map">
		insert into db.ChattingRoomList values(#{chattingRoom},#{members})
	</insert>
	
	
	<!-- ============================ 채 팅 ============================ -->
</mapper>
 